# ゲーム仕様書 - Baseball GM

コードから読み取りにくいゲームルール・数値設計をまとめたドキュメント。
PMはこのファイルを参照して、ゲームバランスに影響する実装を行う。

---

## 能力値体系

### 野手能力（1〜100）
| 能力 | 英名 | 影響 |
|---|---|---|
| ミート | contact | 安打確率に直結 |
| パワー | power | 長打率・本塁打率に影響 |
| 走力 | speed | 三塁打率に影響（盗塁は未実装） |
| 守備力 | fielding | 現在シミュレーション未使用 |
| 選球眼 | eye | 四球率に影響 |

### 投手能力（1〜100）
| 能力 | 英名 | 影響 |
|---|---|---|
| 球速 | velocity | 奪三振率に影響 |
| 制球 | control | 四球率の抑制、被安打率の抑制 |
| 変化球 | breaking | 被安打率の抑制 |
| スタミナ | stamina | 現在シミュレーション未使用（完投固定） |
| 精神力 | mentalToughness | 現在シミュレーション未使用 |

### 潜在能力（ポテンシャル）
| グレード | 出現率 | トレード価値倍率 |
|---|---|---|
| S | 5% | ×1.5 |
| A | 10% | ×1.3 |
| B | 25% | ×1.1 |
| C | 30% | ×1.0 |
| D | 30% | ×0.9 |

---

## 試合シミュレーション

### 打席の判定フロー

```
打席開始
  ↓
死球判定 → 死球なら出塁
  ↓
四球判定 → 四球なら出塁
  ↓
三振判定 → 三振ならアウト
  ↓
インプレー → 打球物理エンジンへ
  ↓
打球生成 (方向・角度・速度) → 打球タイプ分類
  ↓
フィールダー決定 (ゾーンベース)
  ↓
結果判定 (HR/安打/アウト/エラー)
```

### 確率計算式（打席結果判定）

```
contactFactor  = (batter.contact - breakingPower * 0.5) / 100
eyeFactor      = (batter.eye - pitcher.control * 0.3) / 100
velocityFactor = (velocity - 120) / 45
controlFactor  = pitcher.control / 100
```

| 結果 | 確率 | 最低保証 |
|---|---|---|
| 死球 | 0.008 + (1 - controlFactor) × 0.007 | 0.3% |
| 四球 | 0.075 + eyeFactor × 0.05 - controlFactor × 0.04 | 2% |
| 三振 | 0.14 + velocityFactor × 0.08 - contactFactor × 0.06 + finisherBonus | 5% |
| インプレー | 残りの確率 | - |

### 打球物理エンジン

インプレー時に打球の物理データ（方向・角度・速度）を生成し、ゾーンベースでフィールダーを決定する。

#### BattedBall（打球データ）
| プロパティ | 範囲 | 説明 |
|---|---|---|
| direction | 0°〜90° | 打球方向（0=レフト線, 45=センター, 90=ライト線） |
| launchAngle | -15°〜70° | 打球角度（負=ゴロ, 10-20=ライナー, 20-50=フライ, 50+=ポップ） |
| exitVelocity | 80〜185 km/h | 打球速度 |
| type | BattedBallType | 後方互換用の分類 |

#### 打球方向の生成
```
基本: 右打者=38°, 左打者=52°, 両打ち=45°
プル補正: (power - 50) × 0.08 (パワーが高いとプル傾向が強まる)
分布: ガウス乱数 (σ=18°)
```

#### 打球角度の生成
```
基本: 12° + (power - 50) × 0.08 - (contact - 50) × 0.04
シンカーボーナス: sinker.level × 0.6 + shoot.level × 0.4 (最大5°低下)
分布: ガウス乱数 (σ=16°)
```

#### 打球速度の生成
```
基本: 120 + (power - 50) × 0.5 + (contact - 50) × 0.15
変化球ペナルティ: (breakingPower - 50) × 0.15
分布: ガウス乱数 (σ=18 km/h)
```

#### 打球タイプ分類
| 条件 | 分類 |
|---|---|
| launchAngle ≥ 50° | popup |
| launchAngle < 5° | ground_ball |
| 5° ≤ launchAngle < 20° かつ exitVelocity < 100 | ground_ball |
| 5° ≤ launchAngle < 20° かつ exitVelocity ≥ 100 | line_drive |
| 20° ≤ launchAngle < 50° | fly_ball |

#### フィールドゾーンマッピング

**内野ゾーン（ゴロ・低速ライナー）**
```
方向  0°──18°──40°──55°──72°──90°
      | 3B  | SS  | 2B  |   1B   |
※中央(30-60°)+低速(<110km/h)でP返し(12%)
```

**外野ゾーン（フライ・高速ライナー）**
```
方向  0°──────30°──────60°──────90°
      |  LF   |   CF   |   RF   |
```

**ポップフライ**: C=15%, P=中央5%, 残りは内野ゾーンと同様

**ライナーの振り分け**: exitVelocity > 140 または launchAngle > 14° → 外野、それ以外 → 内野

#### バレルゾーン（本塁打判定）
```
条件: exitVelocity ≥ 158 km/h かつ 22° ≤ launchAngle ≤ 38°
バレル時HR率: 0.25 + powerFactor × 0.10
通常フライHR率: 0.03 + powerFactor × 0.06 + (exitVelocity - 120) × 0.001
ライナーHR率: 0.01 + powerFactor × 0.02 + max(0, exitVelocity - 145) × 0.002
```

#### インプレー結果（安打率）
```
ライナー安打率: 0.62 + contactFactor × 0.05 - fieldingFactor × 0.03 (最低0.50)
フライ安打率: 0.12 - fieldingFactor × 0.03 + (exitVelocity - 120) × 0.0005 (最低0.05)
```

### 安打の長打タイプ

安打が発生した場合の内訳（determineHitType）:

| 打球タイプ | 種別 | 確率 |
|---|---|---|
| fly_ball | 三塁打 | 0.06 + speedFactor × 0.04 |
| fly_ball | 二塁打 | 残り |
| line_drive | 二塁打 | 0.20 + powerFactor × 0.08 |
| line_drive | 三塁打 | 0.02 + speedFactor × 0.02 |
| line_drive | 単打 | 残り |
| ground_ball | 二塁打 | 0.08 + speedFactor × 0.03 |
| ground_ball | 単打 | 残り |

### 走塁ルール

| 打撃結果 | 1塁走者 | 2塁走者 | 3塁走者 |
|---|---|---|---|
| 単打/エラー | → 2塁 | → 3塁 | → 生還 |
| 二塁打 | → 3塁 | → 生還 | → 生還 |
| 三塁打 | → 生還 | → 生還 | → 生還 |
| 本塁打 | → 生還 | → 生還 | → 生還 |
| 四球 | → 2塁（押し出し） | → 3塁（満塁時） | → 生還（満塁時） |
| 凡打 | 動かない | 動かない | 動かない |

### 試合進行
- 9回制、同点なら延長12回まで
- 12回終了時同点 → 引き分け
- 9回裏ホームチームリードなら打ち切り
- 先発投手が完投（リリーフ未実装）
- 打順は contact + power + speed 上位9人で自動決定

---

## シーズン構成（NPB準拠 143試合制）

### 日程
| 期間 | 内容 | 日数 |
|---|---|---|
| 前半リーグ戦 | 同リーグ対戦 | 60日 |
| 交流戦 | セパ対抗 | 18日 |
| 後半リーグ戦 | 同リーグ対戦 | 65日 |
| **合計** | | **143日** |

### 試合数
- 同リーグ: 5チーム × 25試合 = 125試合
- 交流戦: 6チーム × 3試合 = 18試合
- 合計: 143試合/チーム、858試合エントリ
- 1日6試合（セ3 + パ3）

### シーズンフェーズ
```
preseason → regular_season → (playoffs: 未実装) → offseason
```

---

## ドラフト

- ウェーバー方式（前年成績下位から指名）
- 5巡、1巡あたり12チーム = 60指名
- 候補者プール: 110人（60 + 余剰50人）
- 候補年齢: 18〜22歳、能力値: 25〜65

### CPU指名ロジック
- 投手: velocity + control + breaking の合計が最大の候補
- 野手: contact + power + speed の合計が最大の候補
- ポジション需要は考慮しない（改善候補）

---

## トレード

### 選手価値の算出

**投手:**
```
value = velocity × 1.2 + control × 1.0 + breaking × 1.1
        + stamina × 0.5 + mentalToughness × 0.3
```

**野手:**
```
value = contact × 1.0 + power × 1.2 + speed × 0.6
        + fielding × 0.4 + eye × 0.8
```

### 年齢補正
| 年齢 | 倍率 |
|---|---|
| 〜25歳 | ×1.3（若手プレミアム） |
| 26〜30歳 | ×1.0（基準値） |
| 31〜33歳 | ×0.7（衰え） |
| 34歳〜 | ×0.4（ベテラン割引） |

### CPU交渉ロジック
```
受諾条件: 提供選手の合計価値 ≥ 要求選手の合計価値 × 0.9
```
CPUは10%の割引で交渉に応じる。

---

## 選手生成

### ロスター構成（1チーム25人）
- 投手11人 + 野手14人

### 生成パラメータ
| 項目 | 範囲 |
|---|---|
| 年齢 | 18〜36歳 |
| 能力基本値 | 30〜75 |
| 能力振れ幅 | 基本値 ± 15（守備・精神は ± 10） |
| 投手生成率 | 35% |

### 年俸計算
```
baseSalary = (overall × 10 + random(-100, 300)) × ageMultiplier
ageMultiplier = 1.0 (30歳以下) / 1.3 (31歳以上)
```
単位: 万円。契約年数: 1〜4年ランダム。

---

## 12チーム一覧

### セントラル・リーグ
| ID | チーム名 | 略称 | カラー | 本拠地 |
|---|---|---|---|---|
| tokyo-eagles | 東京イーグルス | 東京 | 赤 | 東京ドーム |
| yokohama-stars | 横浜スターズ | 横浜 | 青 | 横浜スタジアム |
| nagoya-dragons | 名古屋ドラゴンズ | 名古屋 | 紺 | ナゴヤドーム |
| osaka-tigers | 大阪タイガース | 大阪 | 黄 | 甲子園球場 |
| hiroshima-reds | 広島レッズ | 広島 | 赤 | マツダスタジアム |
| sendai-swallows | 仙台スワローズ | 仙台 | 緑 | 仙台球場 |

### パシフィック・リーグ
| ID | チーム名 | 略称 | カラー | 本拠地 |
|---|---|---|---|---|
| fukuoka-hawks | 福岡ホークス | 福岡 | 琥珀 | 福岡PayPayドーム |
| sapporo-fighters | 札幌ファイターズ | 札幌 | 紺 | エスコンフィールド |
| chiba-marines | 千葉マリーンズ | 千葉 | 黒 | ZOZOマリンスタジアム |
| saitama-lions | 埼玉ライオンズ | 埼玉 | 青 | ベルーナドーム |
| kobe-buffaloes | 神戸バファローズ | 神戸 | 紫 | 京セラドーム |
| tohoku-golden | 東北ゴールデンズ | 東北 | 臙脂 | 楽天モバイルパーク |

---

## 未実装機能（コードに痕跡あり）

| 機能 | 現状 |
|---|---|
| 盗塁 | statsに項目あるがシミュレーション未使用 |
| セーブ | savePitcherId常にnull |
| ホールド | statsに項目あるがインクリメントなし |
| リリーフ投手 | 先発が完投。スタミナ未使用 |
| プレーオフ | フェーズは定義済みだがスケジュール生成なし |
| 守備力 | 能力値あるがシミュレーション未使用 |
| 精神力 | 能力値あるがシミュレーション未使用 |
| 打順設定 | 能力値合計で自動決定、手動設定不可 |
