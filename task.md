# タスクリスト

## 完了済み
- [x] NPB風143試合スケジュール（同リーグ25試合×5 + 交流戦3試合×6）
- [x] パワプロ風成績ページ（タイトル争い・打撃/投手テーブル・セイバー指標）
- [x] ダッシュボードのセパ分割順位表・GM視点シム操作パネル
- [x] 全ページUX改善（tabular-nums・ストライプ・ホバー・能力値色分け）
- [x] 打順・ローテーション設定（打順9枠、先発ローテ5-6人、クローザー/セットアッパー指定、CPU自動配置）
- [x] ロスター拡張（25人→65人、1軍/2軍制、昇格・降格UI、1軍28人制限）
- [x] クライマックスシリーズ + 日本シリーズ（CS 1st/Final + 日本シリーズ、アドバンテージ制）
- [x] 表彰式（MVP・首位打者・本塁打王・打点王・盗塁王・最多安打・最優秀防御率・最多勝・最高勝率・最多奪三振・最多セーブ・日本シリーズMVP）
- [x] 契約更改・加齢エンジン（年齢+1、契約年数-1、退団/更新、若手成長/ベテラン衰退）
- [x] ドラフトUI（候補一覧ソート/フィルタ、指名ボタン、CPU自動指名、指名履歴）
- [x] トレードUI（相手チーム選択、選手価値比較、CPU受諾判定）
- [x] 春季キャンプ（ポテンシャルベースの成長/衰退、キャンプレポート表示）
- [x] オフシーズンフロー（表彰→契約→ドラフト→完了のステップ進行）
- [x] 翌シーズン遷移（年間サイクルのループ完成）

## 選手起用・オーダー設定（残り）
- 野手起用法: 守備固め、代打、代走、途中交代
- 投手起用法: 勝利投手条件、スタミナ限界、中継ぎエース、敗戦処理、リード時、守護神

## 基本ステータスの見直し
- ミート、パワー、走力、肩力、守備力、捕球の基本ステータス（1~100刻み？）
- 守備位置、選球眼、潜在等は生かせるか？
- 投手は球速を150kmなどの実数表記にする
- 投手: 制球、変化球（パワプロ風に変化量を設定する。プロスピは球威と変化量で分かれているがどう扱うか検討）、スタミナ、精神、潜在
- 投手にも守備力が必要

## 外国人助っ人の追加
- 外国人枠の制限
- 助っ人選手の生成・獲得

## サブポジションの実装
- 複数ポジション対応
- ポジション適性の表示

## 特殊能力の実装
- どこまで行うか検討が必要
- パワプロ風の特殊能力？

## けが・大けがの実装
- 試合中の故障発生
- 離脱期間の設定

## FA・海外進出
- FA宣言・交渉
- 海外移籍（MLB等）

## 財務システム
- チーム強さ → ファン数増減 → シーズンオフ収入変動
- 選手年俸の設定・交渉
- どこまで複雑にするか検討が必要

## 練習設定
- 練習メニューの設定
- 選手成長への影響

---


## シミュレーション守備改修＋守備・投手指標の追加
現在のシミュレーションは守備がほぼ未実装。打球処理・守備位置の概念を入れて、守備指標と投手の打球系指標を追加する。

### Step 1: 打球処理の基盤整備（simulation.ts 改修） ✅ 完了
- [x] 打球に種類を持たせる（ゴロ / フライ / ライナー / ポップフライ）
- [x] 打者のパワー・ミートと投手の球種（シンカー系ボーナス）から打球種類の確率を決定
- [x] 守備位置に応じて処理する野手を重み付きランダムで決定
- [x] fielding / catching / arm を使ってアウト成功率・エラー率を計算
- [x] 盗塁の実装（走力 vs 捕手肩力）※前回実装済み
- [x] ダブルプレーの実装（1塁走者+2アウト未満+内野ゴロ時）
- [x] 死球 (HBP) の実装（制球力に連動）
- [x] 犠牲フライの実装（3塁走者+2アウト未満+フライアウト時）
- [x] 内野安打の実装（走力 vs 守備力）
- [x] フィルダースチョイスの実装（走者あり時5%）
- [x] 成績ページにPA/OBP/wOBA計算修正 + 死球/犠飛/併殺列追加

### Step 2: 守備成績の記録（モデル追加）
- 選手ごとに刺殺(PO)、補殺(A)、失策(E) を記録
- PlayerGameStats に守備フィールドを追加
- 守備率 = (PO+A) / (PO+A+E)
- レンジファクター = (PO+A) / 試合数

### Step 3: 守備指標（UZR等）
- 簡易UZR: 守備位置の平均対比で守備貢献ランを算出
- DRS (Defensive Runs Saved) も同様のアプローチで
- 成績ページに守備指標タブ/列を追加

### Step 4: 投手の打球系指標
- GB% (ゴロ率)、FB% (フライ率)、LD% (ライナー率)
- GB/FB 比率
- IFFB% (内野フライ率)
- HR/FB (フライに対する本塁打率)
- 成績ページの投手セイバー指標に追加

### 備考
- Step 1 が最も工数が大きい（simulation.ts の大幅改修）
- Step 2-4 は Step 1 の上に乗せる形なので比較的軽い
- 能力値 fielding / catching / arm は既にモデルに定義済み（野手・投手とも）

## 球種のビジュアル表示（保留）
- 現在はテーブル内テキスト表示（球種名+変化量）で仮実装
- パワプロ風のグラフィカル表示を検討したが、テーブルセル内に収まるサイズでは見づらかった
  - ブロック/セグメント式（5方向矢印）→ テーブル行が巨大化して一覧性が悪い
  - ラジアルドットチャート（test.jsx）→ コンパクトにすると文字が潰れて見づらい
- test.jsx にラジアルチャートの参考実装あり。選手詳細画面など広いスペースで使えるかも
- 今後の方向性: 選手個別詳細ページを作ったときにそこで使う、またはホバー/クリックポップアップで別途検討

## PMからの提案
<!-- PMが実装中に気づいた課題・改善点をここに追記する -->
<!-- 人間が確認して正式タスクに昇格させるか、却下する -->

