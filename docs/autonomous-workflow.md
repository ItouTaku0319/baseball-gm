# 自律開発ワークフロー

## PMの自律サイクル（ReActループ）

```
[Observe] 観察
  1. task.md を読み、自律実行可能な最優先タスクを選ぶ
  2. 依存タスクが完了しているか確認
  3. 関連コードを読んで現状を把握
  4. docs/patterns.md で該当パターンがあれば手順を確認
  5. docs/baseball-knowledge.md で関連する野球知識を確認
  6. TaskCreateで進捗追跡を開始

[Think] 設計
  7. 完了条件を基に実装方針を決定
  8. 変更ファイルのリストアップ（並列可否の判断）

[Act] 実行
  9. 実装くんに委譲 → build確認 → バランステスト（該当時）
  10. レビューくん呼出（大きい変更の場合）

[Guard] 監査
  11. ガーディアンくんに監査を委譲
      - 完了条件の充足確認
      - ドキュメント整合性チェック
      - セーブ互換性チェック
      - NPBベンチマーク照合
  12. FAIL → [Think]に戻って修正（最大2回リトライ）
  13. PASS → 次へ

[Reflect] 振り返り
  14. 何がうまくいった/いかなかったかをメモ
  15. 発見した課題があればtask.mdのPM提案セクションに追記

[Update] 記録
  16. commit & push
  17. task.md 更新（完了マーク + 発見タスク追記）
  18. CLAUDE.md 更新（設計メモ・ディレクトリ構成）
  19. reports/ に作業報告を出力
  20. 次のタスクへ（1セッション2-3タスク上限）
```

## 品質ゲート

```bash
# 必須（全タスク）
npm run build

# シミュレーション変更時
npx tsx scripts/test-balance-full.ts --games=1000
# → 全指標正常 + 異常パターン0件 + exit code 0

# 型変更時
# 既存セーブデータのマイグレーション実装を確認
# ?? でのデフォルト値 or loadGame内のマイグレーション

# 全タスク（コミット前）
# ガーディアンくんによる監査 → PASS必須
```

## 報告義務

各セッション終了時に `reports/YYYY-MM-DD.md` に以下を記録:
- 着手したタスクと結果（完了/中断/スキップ）
- コミットハッシュ
- ガーディアン監査結果（PASS/FAIL）
- 発見した課題・提案タスク
- バランステスト結果（該当時）
- 次に着手すべきタスクの推奨

## 参照ドキュメント体系

| ファイル | 役割 | いつ参照するか |
|---|---|---|
| `task.md` | タスク一覧・完了条件・優先度 | タスク選定時、完了確認時 |
| `GAME_SPEC.md` | ゲームルール・数値設計の仕様 | 実装時、ガーディアン監査時 |
| `docs/baseball-knowledge.md` | 野球ドメイン知識・NPBベンチマーク | 設計時、バランス検証時 |
| `docs/patterns.md` | 実装パターン・手順書・アンチパターン | 実装開始前、ガーディアン監査時 |
| `docs/design-decisions.md` | 過去の設計判断・バランス調整履歴 | 関連機能の修正時 |
| `CLAUDE.md` | プロジェクト知識・ルール | 常時 |
