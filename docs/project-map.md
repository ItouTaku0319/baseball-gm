# Baseball GM プロジェクトマップ

## システム全体図

```
┌─────────────────────────────────────────────────────────┐
│                    UI層 (Next.js)                        │
│  dashboard / roster / lineup / schedule / stats /        │
│  analytics / pitching / draft / trade / standings         │
└────────────────────────┬────────────────────────────────┘
                         │
┌────────────────────────┴────────────────────────────────┐
│                  ストア層 (Zustand)                       │
│              game-store.ts (状態管理)                     │
└────────────────────────┬────────────────────────────────┘
                         │
┌────────────────────────┴────────────────────────────────┐
│                  エンジン層 (純粋関数)                     │
│                                                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐               │
│  │ 試合シム  │  │ シーズン  │  │ 選手管理  │               │
│  │          │  │          │  │          │               │
│  │simulation│  │season    │  │player-gen│               │
│  │fielding  │  │season-adv│  │lineup    │               │
│  │physics   │  │playoffs  │  │roster    │               │
│  │          │  │awards    │  │draft     │               │
│  │          │  │preseason │  │trade     │               │
│  │          │  │offseason │  │          │               │
│  └──────────┘  └──────────┘  └──────────┘               │
└─────────────────────────────────────────────────────────┘
                         │
┌────────────────────────┴────────────────────────────────┐
│                  データ層 (IndexedDB)                     │
│           db/database.ts + save-load.ts                  │
└─────────────────────────────────────────────────────────┘
```

## 試合シミュレーション詳細（今の重点領域）

```
投球 → コンタクト判定 → ファウル/インプレー分岐
                              │
                    ┌─────────┴─────────┐
                    │                   │
               ファウル              インプレー
            (確率テーブル)              │
            strike++           generateBattedBall()
                                  direction (0-90°)
                                  launchAngle (-15~70°)
                                  exitVelocity (80-170km/h)
                                        │
                                  calcBallLanding()
                                        │
                              ┌─────────┴─────────┐
                              │                   │
                         HR判定             守備AI判定
                      (フェンス越え)    (fielding-ai.ts)
                              │                   │
                              │         evaluateFielders()
                              │         resolvePlayWithAI()
                              │                   │
                              └─────────┬─────────┘
                                        │
                                  advanceRunners()
                                  (固定テーブル)
                                        │
                                    結果確定
```

## 各システムの成熟度

### 完成度: 高 (安定稼働中)
| システム | ファイル | 状態 |
|---------|---------|------|
| シーズン生成・日程 | season.ts | NPB準拠143試合 |
| 順位計算 | season.ts | 勝率→直接対戦→得失点差 |
| CS・日本シリーズ | playoffs.ts | 3ステージ制 |
| 表彰 | awards.ts | MVP/ベストナイン等 |
| ドラフト | draft.ts | ウェーバー方式 |
| トレード | trade.ts | 選手価値算出+CPU交渉 |
| 契約更改・加齢 | offseason.ts | 年俸交渉+成長/衰退 |
| 投手交代AI | simulation.ts | スタミナ/ERA/連投制限 |
| バント | simulation.ts | 犠牲+セーフティ |
| 途中交代 | simulation.ts | 代打/代走/守備固め |
| けが・故障 | simulation.ts | 発生+日次回復 |

### 完成度: 中 (動くが改善が必要)
| システム | 問題 | 改善方針 |
|---------|------|---------|
| 守備AI | 中央集権型、ライナーアウト率低い | → エージェント型に書き換え (plan.txt) |
| 打球生成 | ファウルゾーンなし、clamp artifacts | → 方向拡張+物理ファウル判定 |
| 走者進塁 | 固定テーブル | → 物理ベース化 (plan.txt内) |
| 盗塁 | 試行率が低い | → 数値調整 |
| エラー | スキル依存なし | → fielding能力による確率変動 |

### 完成度: 低 (未実装)
| システム | 重要度 | 実装コスト |
|---------|--------|-----------|
| ワイルドピッチ/パスボール | 高 | 低 |
| ボーク | 中 | 低 |
| 牽制球 | 中 | 中 |
| 捕手送球の分化 | 中 | 低 |
| ファウルフライアウト | 高 | 中 (打球生成と同時) |
| ファウルチップ三振 | 中 | 低 (打球生成と同時) |
| 天候・球場特性 | 低 | 高 |
| 外国人助っ人 | 中 | 中 |
| 特殊能力 | 中 | 高 |
| FA・海外移籍 | 低 | 高 |
| 財務システム | 低 | 高 |

## チーム体制

```
┌─────────────────────────────────────┐
│          あなた (GM/PO)              │
│  方針決定・優先度判断・最終承認       │
└──────────────┬──────────────────────┘
               │
┌──────────────┴──────────────────────┐
│        Claude Code (PM/テックリード)  │
│  タスク分解・設計・委譲・品質管理     │
│  このセッション = PMセッション       │
└──────┬───────┬───────┬──────────────┘
       │       │       │
  ┌────┴──┐┌───┴───┐┌──┴────┐
  │engine ││  ui   ││ data  │  ← 実装エージェント
  │(sonnet)│(sonnet)│(sonnet)│
  └───────┘└───────┘└───────┘
       │       │       │
  ┌────┴───────┴───────┴──────┐
  │  tester / reviewer /       │  ← 検証エージェント
  │  guardian (読み取り専用)     │
  └────────────────────────────┘
```

### 役割の明確化

| 役割 | 誰 | やること | やらないこと |
|------|-----|---------|-------------|
| GM/PO | あなた | 方針決定、優先度、承認 | 実装の詳細判断 |
| PM | Claude (このセッション) | 設計、タスク分解、委譲、進捗管理 | 方針の独断決定 |
| 実装 | impl-* エージェント | コード書く、テスト通す | 設計判断 |
| 検証 | tester/reviewer/guardian | 品質チェック、指摘 | コード修正 |
