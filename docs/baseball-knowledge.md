# 野球ドメイン知識

このドキュメントはBaseball GMの開発に必要な野球知識を構造化したもの。
PMおよびサブエージェントがゲームバランス判断・指標実装・品質チェックに使用する。

参考サイト:
- https://1point02.jp/op/gnav/glossary/gls_index.aspx?cp=101
- https://baseball-datapark.skr.jp/sabermetrics/glossary/

---

## 1. NPB基本ルール

### リーグ構成
- セントラル・リーグ（セ）6チーム + パシフィック・リーグ（パ）6チーム = 12チーム
- パ・リーグはDH制（投手が打席に立たない）
- セ・リーグはDHなし（2025年からセもDH採用の可能性あり、本ゲームでは両リーグDHなし）

### 試合数
- レギュラーシーズン: 143試合（同リーグ25試合×5チーム + 交流戦3試合×6チーム）
- 1日6試合（セ3+パ3）
- 9回制、同点なら延長12回まで、引き分けあり

### ポストシーズン
- クライマックスシリーズ（CS）: 1stステージ(3試合制) → Finalステージ(6試合制、1位にアドバンテージ1勝)
- 日本シリーズ: セパ各1位同士の7試合制

### ロスター
- 一軍登録: 最大28人（投手13人以内が一般的）
- 外国人枠: 一軍4人まで（投手3+野手1 or 投手2+野手2など柔軟）
- 支配下登録: 最大70人

### 先発ローテーション
- 通常6人ローテ（NPBは中6日が基本、MLBは中4日で5人ローテ）
- 週6試合のため、6人ローテが自然

---

## 2. 打撃指標

### 基本指標

| 指標 | 正式名 | 計算式 | 意味 | NPB目安 |
|---|---|---|---|---|
| AVG | 打率 | H / AB | 打数に対する安打の割合。最も伝統的な打撃指標 | .260前後（首位打者.330+） |
| OBP | 出塁率 | (H+BB+HBP) / (AB+BB+HBP+SF) | 打席に対する出塁の割合。四球・死球も含む | .330前後（優秀.380+） |
| SLG | 長打率 | TB / AB | 打数あたりの塁打数。長打力を示す | .400前後（優秀.500+） |
| OPS | OPS | OBP + SLG | 出塁率+長打率。簡易的な打撃総合力 | .730前後（優秀.850+） |
| ISO | Isolated Power | SLG - AVG | 純粋な長打力。単打を除いた塁打能力 | .140前後（強打者.200+） |
| PA | 打席数 | AB+BB+HBP+SF+SH | 全打席数（犠打含む） | 規定=443(143×3.1) |
| AB | 打数 | PA-BB-HBP-SF-SH | 打率の分母となる打席数 | - |
| TB | 塁打 | 1B+2B×2+3B×3+HR×4 | 安打による総塁数 | - |

### セイバーメトリクス打撃指標

| 指標 | 正式名 | 計算式 | 意味 | NPB目安 |
|---|---|---|---|---|
| wOBA | Weighted On-Base Average | (W_BB×BB+W_HBP×HBP+W_1B×1B+W_2B×2B+W_3B×3B+W_HR×HR)/PA | 各打撃結果に得点価値で重み付けした出塁率。最も信頼できる打撃指標の一つ | .320前後（優秀.370+） |
| wRAA | Weighted Runs Above Average | ((wOBA-lgWOBA)/WOBA_SCALE)×PA | リーグ平均打者と比べた得点貢献。0が平均 | 0が平均（+20で優秀） |
| wRC+ | Weighted Runs Created Plus | 100×((wOBA-lgWOBA)/WOBA_SCALE+lgR/PA)/(lgR/PA) | リーグ平均を100とした打撃貢献指数 | 100が平均（120+で優秀） |
| OPS+ | OPS Plus | (OBP/lgOBP+SLG/lgSLG-1)×100 | リーグ平均を100としたOPS指数 | 100が平均 |
| BABIP | Batting Average on Balls In Play | (H-HR)/(AB-K-HR+SF) | インプレーになった打球の安打率。運と打球品質の指標 | .290-.310（極端なら要注意） |
| K% | 三振率 | K/PA | 打席あたりの三振割合 | 18-22%（低いほど良い） |
| BB% | 四球率 | BB/PA | 打席あたりの四球割合 | 7-10%（高いほど良い） |
| BB/K | BB/K比 | BB/K | 選球眼の指標。高いほど良い | 0.40前後（優秀0.60+） |
| RC | Runs Created | (H+BB)×TB/(AB+BB) の基本形 | チームの得点創出量を個人に帰属 | - |

### wOBAリニアウェイト（本ゲーム使用値、MLB 2023基準）
| 結果 | ウェイト | 意味 |
|---|---|---|
| 四球(BB) | 0.69 | 四球1つは0.69点分の価値 |
| 死球(HBP) | 0.72 | 死球は四球よりやや高い（走者が進む場合が多い） |
| 単打(1B) | 0.87 | 単打は四球より高い（走者をより進められる） |
| 二塁打(2B) | 1.27 | 二塁打は単打の約1.5倍の価値 |
| 三塁打(3B) | 1.62 | 三塁打は稀だが高価値 |
| 本塁打(HR) | 2.10 | 本塁打は最も高価値 |
| WOBA_SCALE | 1.157 | wOBAをOBPスケールに揃える定数 |

**なぜwOBAが重要か**: 打率は単打も本塁打も同じ1安打として扱うが、wOBAは得点への貢献度に応じて異なる重みを付ける。得点との相関が最も高い打撃指標。

### 走塁指標

| 指標 | 正式名 | 計算式 | 意味 |
|---|---|---|---|
| SB | 盗塁 | （記録値） | 盗塁成功数 |
| CS | 盗塁死 | （記録値） | 盗塁失敗数 |
| SB% | 盗塁成功率 | SB/(SB+CS) | 盗塁の成功割合。70%以上が目安 |
| wSB | 盗塁得点貢献 | SB×runSB+CS×runCS | 盗塁による得点貢献（プラスなら盗塁すべき） |
| UBR | 走塁得点貢献 | （高度な計算） | 盗塁以外の走塁（進塁、タッチアップ等）の貢献 |
| Spd | スピードスコア | 盗塁率+盗塁企図率+三塁打率+得点率の複合 | 走力の総合指標 |

---

## 3. 投手指標

### 基本指標

| 指標 | 正式名 | 計算式 | 意味 | NPB目安 |
|---|---|---|---|---|
| ERA | 防御率 | ER/IP×9 | 9回あたりの自責点。投手の基本指標 | 3.50前後（エース2.50以下） |
| W/L | 勝敗 | （記録値） | 勝利・敗戦数 | 最多勝15勝前後 |
| IP | 投球回 | （アウト数/3） | 投球したイニング数 | 規定=143回 |
| WHIP | WHIP | (BB+H)/IP | 投球回あたりの出塁許容。低いほど良い | 1.20前後（優秀1.00以下） |
| K/9 | 奪三振率 | K/IP×9 | 9回あたりの奪三振数 | 7.0前後（優秀9.0+） |
| BB/9 | 与四球率 | BB/IP×9 | 9回あたりの与四球数。低いほど良い | 3.0前後（優秀2.0以下） |
| HR/9 | 被本塁打率 | HR/IP×9 | 9回あたりの被本塁打数 | 0.8前後 |
| K/BB | K/BB比 | K/BB | 奪三振と与四球の比率。投手の制球力指標 | 2.5前後（優秀3.5+） |
| SV | セーブ | （記録値） | セーブ数 | 最多セーブ35+前後 |
| HLD | ホールド | （記録値） | ホールド数 | - |

### セイバーメトリクス投手指標

| 指標 | 正式名 | 計算式 | 意味 | NPB目安 |
|---|---|---|---|---|
| FIP | Fielding Independent Pitching | (13×HR+3×BB-2×K)/IP+cFIP | 守備に依存しない投手力。被本塁打・与四球・奪三振のみで評価 | 3.50前後（ERAと概ね一致） |
| xFIP | Expected FIP | (13×lgHR/FB%×FB+3×BB-2×K)/IP+cFIP | FIPの被HRをリーグ平均HR/FB率で置換。運の要素を排除 | FIPに近い値 |
| ERA+ | ERA Plus | (lgERA/ERA)×100 | リーグ平均を100とした防御率指数。高いほど良い | 100が平均（130+で優秀） |
| cFIP | FIP定数 | lgERA-(13×lgHR+3×lgBB-2×lgK)/lgIP | リーグのERA水準からFIPのスケールを調整する定数 | リーグ毎に異なる |
| BABIP | 被BABIP | (H-HR)/(TBF-K-HR-BB-HBP) | 投手の被インプレー安打率。守備や運の影響が大きい | .290-.310 |
| LOB% | 残塁率 | 出塁走者のうちホームに帰らなかった割合 | 走者を出しても点を取られない能力。高いほど良い | 72%前後 |
| K% | 奪三振率(対打者) | K/TBF | 対戦打者数に対する奪三振割合 | 19-22% |
| BB% | 与四球率(対打者) | BB/TBF | 対戦打者数に対する与四球割合 | 7-9% |
| K-BB% | K-BB% | K%-BB% | 奪三振率と与四球率の差。投手支配力の簡潔な指標 | 12%前後（優秀17%+） |

### DIPS理論（Defense Independent Pitching Statistics）
**核心的な考え方**: 投手がコントロールできるのは「三振・四球・本塁打」の3つだけ。打球がヒットになるかどうかは守備と運に依存する。

- FIPはこの理論に基づく指標
- ERAが良いのにFIPが悪い投手 = 守備や運に助けられている（将来悪化する可能性）
- ERAが悪いのにFIPが良い投手 = 守備や運に恵まれていない（将来改善する可能性）
- **シミュレーションへの接続**: 本ゲームではfielding-ai.tsの守備判定が「運」部分を担当。FIPとERAの乖離は守備力の差として自然に発生する

### 打球系指標

| 指標 | 計算式 | 意味 | NPB目安 |
|---|---|---|---|
| GB% | ゴロ数/BIP | ゴロ率。高いとゴロアウトが多い | 42-48% |
| FB% | フライ数/BIP | フライ率 | 30-38% |
| LD% | ライナー数/BIP | ライナー率。高いほど強い打球が多い | 19-22% |
| IFFB% | ポップ/(フライ+ポップ) | 内野フライ率。高いほど凡打が多い | 8-12% |
| HR/FB | HR/フライ数 | フライの本塁打率 | 10-14% |
| GB/FB | ゴロ/フライ | ゴロとフライの比率 | 1.0-1.3 |

**シミュレーションへの接続**: 打球タイプはlaunchAngle（打球角度）で決定。パワーが高い打者はフライ率が上がり、シンカー系投手はゴロ率にボーナス。

---

## 4. 守備指標

### 基本守備指標

| 指標 | 計算式 | 意味 |
|---|---|---|
| PO | 刺殺 | 走者をアウトにした回数 |
| A | 補殺 | アウトを補助した回数 |
| E | 失策 | 守備のエラー |
| TC | 守備機会 | PO+A+E |
| FP% | 守備率 | (PO+A)/TC。高いほどエラーが少ない |
| RF | レンジファクター | (PO+A)/G×9。試合あたりの守備範囲 |

### 高度な守備指標

| 指標 | 意味 | 備考 |
|---|---|---|
| UZR | Ultimate Zone Rating | フィールドをゾーンに分割し、各ゾーンでの打球処理能力を平均と比較。プラスが平均以上。MLB/NPBで標準的な守備指標 |
| DRS | Defensive Runs Saved | UZRと類似の概念。打球処理による失点防止の貢献量 |
| ARM | 外野送球貢献 | 外野手の送球（進塁阻止、補殺）による貢献 |
| DPR | 併殺貢献 | 内野手の併殺完成による貢献 |
| ErrR | 失策抑止貢献 | 失策を少なく抑えることによる貢献 |
| RngR | 守備範囲貢献 | 打球到達範囲の広さによる貢献 |
| DER | Defensive Efficiency Ratio | チームの打球アウト変換率。(BIP-H)/BIP |

**シミュレーションへの接続**: 本ゲームではfielding-ai.tsで9野手の到達時間を物理計算。UZR/DRSはポジション別平均との対比で簡易算出。RngRは(PO+A)/G差×0.8、ErrRはE/G差×0.7。

---

## 5. 総合指標

### WAR (Wins Above Replacement)
最も重要な総合指標。「代替可能な選手（マイナーリーガー等）に比べて何勝分の価値があるか」を示す。

**野手WAR**:
```
WAR = (wRAA + 守備貢献 + 走塁貢献 + ポジション補正 + リプレイスメント補正) / RPW
RPW = Runs Per Win ≈ 10
```

**投手WAR**:
```
WAR = (リプレイスメントレベル - FIP) / 9 × IP / RPW
リプレイスメントレベル = lgERA × 1.1
```

**WAR目安**:
| WAR | 評価 |
|---|---|
| 0-1 | ベンチ/控え級 |
| 1-2 | 先発レギュラー級 |
| 2-4 | 好選手 |
| 4-6 | オールスター級 |
| 6-8 | MVP候補 |
| 8+ | 歴史的シーズン |

**注意**: 本ゲームでは守備貢献と走塁貢献を簡易化しているため、WARの精度はMLB版ほど高くない。

---

## 6. 得点期待値と勝利確率

### 得点期待値（Run Expectancy）
塁状況(8パターン) × アウト数(3パターン) = 24状況ごとの「そのイニングの残り期待得点」。

**NPB典型値（参考）**:
| 状況 | 0アウト | 1アウト | 2アウト |
|---|---|---|---|
| 走者なし | 0.47 | 0.26 | 0.10 |
| 1塁 | 0.85 | 0.52 | 0.22 |
| 2塁 | 1.10 | 0.67 | 0.32 |
| 3塁 | 1.37 | 0.95 | 0.36 |
| 1,2塁 | 1.47 | 0.92 | 0.44 |
| 1,3塁 | 1.75 | 1.21 | 0.48 |
| 2,3塁 | 1.96 | 1.36 | 0.53 |
| 満塁 | 2.26 | 1.57 | 0.68 |

**用途**:
- 犠打の価値判断（0アウト1塁 0.85点 → 犠打成功で1アウト2塁 0.67点 = -0.18点。犠打は期待値を下げる）
- 盗塁の損益分岐点計算
- 各プレーの得点貢献（RE24）の算出

### ピタゴラス勝率
```
勝率 = RS² / (RS² + RA²)
RS = 総得点、RA = 総失点
```
チームの得失点から期待される勝率。実際の勝率との乖離は「運」の要素。

### WPA (Win Probability Added)
各打席での勝利確率の増減。クラッチ場面での貢献を測る指標。
- 計算には「状況別勝利確率テーブル」が必要（イニング×点差×塁状況×アウト数）
- 工数が大きいため本ゲームでは未実装

---

## 7. NPBベンチマーク（シミュレーション検証用）

### チーム成績の正常範囲（1試合あたり）
| 指標 | 下限 | 典型値 | 上限 | 備考 |
|---|---|---|---|---|
| 得点 | 3.0 | 3.5-4.0 | 5.0 | 両チーム合計7-8点 |
| HR | 0.8 | 1.0-1.3 | 1.8 | 両チーム合計2-3本 |
| 安打 | 7.5 | 8.5-9.0 | 10.5 | - |
| 四球 | 2.5 | 3.0-3.5 | 4.5 | - |
| 三振 | 6.0 | 7.0-8.0 | 9.5 | - |

### 個人成績の正常範囲（シーズン）
| 指標 | 下限 | 典型 | 上限 | 備考 |
|---|---|---|---|---|
| 打率 | .220 | .260 | .340 | 首位打者.330前後 |
| HR | 0 | 15 | 45 | 本塁打王40本前後 |
| 打点 | 10 | 60 | 120 | 打点王100前後 |
| 盗塁 | 0 | 8 | 50 | 盗塁王40前後 |
| 先発ERA | 2.00 | 3.50 | 5.00 | 最優秀防御率2.00前後 |
| 勝利 | 0 | 8 | 18 | 最多勝15前後 |
| 奪三振 | 30 | 120 | 220 | 最多奪三振180前後 |

### バランステスト基準値（1000試合平均）
本ゲームのバランステスト (`scripts/test-balance-full.ts`) で使用する合格基準:

| 指標 | 下限 | 上限 | 根拠 |
|---|---|---|---|
| チーム打率 | .240 | .280 | NPBリーグ打率の変動幅 |
| HR/試合(両チーム) | 1.0 | 1.5 | NPB平均1.0-1.3 |
| K% | 15% | 25% | NPB平均19-22% |
| BB% | 7% | 12% | NPB平均8-10% |
| BABIP | .280 | .320 | 理論値.300付近 |
| GO/AO | 0.8 | 1.3 | NPB平均1.0-1.2 |

---

## 8. 指標間の関係図

```
   [打撃]                          [投手]
   PA(打席数)                      TBF(対戦打者数)
    ├─ K%(三振率)                   ├─ K%(奪三振率)
    ├─ BB%(四球率)                  ├─ BB%(与四球率)
    ├─ AVG(打率)                    ├─ ERA(防御率)
    │   └─ BABIP(運+打球品質)       │   └─ BABIP(運+守備)
    ├─ ISO(長打力)                  ├─ FIP(守備無関係投手力)
    ├─ wOBA(加重出塁率)             │   ├─ K(三振)
    │   ├─ wRAA(平均比貢献)         │   ├─ BB(四球)
    │   │   └─ wRC+(指数化)         │   └─ HR(被本塁打)
    │   └─ WAR(総合価値)            ├─ xFIP(FIPの安定版)
    └─ OPS(簡易総合)                └─ WAR(総合価値)
        ├─ OBP(出塁率)
        └─ SLG(長打率)

   [守備]                          [打球物理]
   UZR(総合守備貢献)                GB%(ゴロ率)
    ├─ RngR(守備範囲)               FB%(フライ率)
    ├─ ErrR(失策抑止)               LD%(ライナー率)
    └─ ARM(送球貢献)                HR/FB(フライ本塁打率)
```

---

## 9. シミュレーションとの接続マップ

各指標が本ゲームのどのコードで計算・影響されるかの対応表。

| 指標 | 影響する能力値 | 対応コード | 備考 |
|---|---|---|---|
| AVG/安打率 | contact, eye | simulation.ts (hitRate計算) | contactが高い→三振少ない→打率上がる |
| HR | power, trajectory | simulation.ts (estimateDistance) | power→打球速度、trajectory→打球角度・キャリー |
| K% | velocity, contact | simulation.ts (strikeoutRate) | velocity高い投手→三振多い、contact高い打者→三振少ない |
| BB% | eye, control | simulation.ts (walkRate) | eye高い→四球多い、control高い→四球少ない |
| ERA/FIP | velocity, control, pitchLevels | simulation.ts 全体 | 投手3能力の総合結果 |
| BABIP | fielding (守備側) | fielding-ai.ts | 守備力高い→打球処理成功率上がる→BABIP下がる |
| GB% | pitchLevels (sinker/shoot) | simulation.ts (angleMean) | シンカー系でゴロ率ボーナス |
| SB | speed, arm(捕手) | simulation.ts | 走力vs捕手肩力 |
| UZR | fielding, arm, catching | fielding-ai.ts | 全守備能力が守備AIの判定に影響 |

---

## 10. 未実装だが検討中の指標

| 指標 | 意味 | 実装難易度 | 前提条件 |
|---|---|---|---|
| WPA | 勝利確率増減 | 高 | 状況別勝利確率テーブルが必要 |
| LI | Leverage Index（場面重要度） | 高 | WPAと同じテーブルが必要 |
| RE24 | 得点期待値増減 | 中 | 得点期待値テーブルが必要（GAME-004で実装予定） |
| Clutch | 重要場面での働き | 高 | WPAとLIが前提 |
| パークファクター | 球場補正 | 中 | 球場ごとの特性定義が前提 |
| RC | Runs Created | 低 | 計算式のみで実装可能 |
| BsR | 走塁貢献 | 中 | 走塁の詳細記録が必要 |
| tRA | 打球込みの投手評価 | 中 | 打球タイプ別のランバリューが必要 |
