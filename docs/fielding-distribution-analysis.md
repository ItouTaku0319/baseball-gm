# NPB守備機会分布 vs シミュレーション比較分析

## 概要

シミュレーションの守備機会分布がNPB実データとどれだけ乖離しているかを分析し、調整方針をまとめた資料。

---

## 1. NPB実データ（2020-2025 6年平均）

出典: npb.jp 2020-2025年度セ・パ両リーグ球団別個人守備成績 + チーム守備成績

### チーム平均（1試合あたり）

| 指標 | NPB 6年平均 |
|---|---|
| 刺殺 (PO) / 試合 | ~26.69 |
| 補殺 (A) / 試合 | ~10.30 |
| 失策 (E) / 試合 | ~0.50 |
| 守備機会 (TC) / 試合 | ~37.49 |

### ポジション別（1チーム1試合あたり、6年平均）

| Pos | PO/G | A/G | E/G | TC/G | 備考 |
|---|---|---|---|---|---|
| P | 0.47 | 1.33 | 0.07 | 1.87 | A=ゴロ処理・中継。自身のPOは少ない |
| C | 7.33 | 0.78 | 0.04 | 8.15 | 三振(PO)が大部分。A=盗塁刺・バント処理等 |
| 1B | 8.57 | 0.65 | 0.06 | 9.28 | PO最多。内野ゴロの送球受け |
| 2B | 2.10 | 3.00 | 0.07 | 5.17 | A>POが特徴。併殺中継も含む |
| 3B | 0.67 | 1.61 | 0.10 | 2.38 | 最も守備機会少ない内野。E率高め |
| SS | 1.56 | 2.80 | 0.09 | 4.45 | A最多の内野。広い守備範囲 |
| LF | ~1.77 | ~0.04 | ~0.02 | ~1.84 | *推定値（OF合計5.99からMLB比率で按分） |
| CF | ~2.34 | ~0.04 | ~0.02 | ~2.41 | *推定値（最も守備機会多い外野） |
| RF | ~1.88 | ~0.04 | ~0.02 | ~1.95 | *推定値 |
| **合計** | **~26.69** | **~10.30** | **~0.50** | **~37.49** | |

> 注: LF/CF/RFの個別値はNPBでは外野手一括集計のため、MLB 2024のLF:CF:RF比率（29.6%:39.1%:31.3%）を使って按分推定。
> OF合計PO=5.99, A=0.13, E=0.07はNPB実データ。

### 年別推移（PO/試合）

| Pos | 2020 | 2021 | 2022 | 2023 | 2024 | 2025 | 平均 |
|---|---|---|---|---|---|---|---|
| C | 7.57 | 7.43 | 7.39 | 7.29 | 7.02 | 7.30 | 7.33 |
| 1B | 8.75 | 8.43 | 8.57 | 8.61 | 8.64 | 8.43 | 8.57 |
| 2B | 2.07 | 1.99 | 2.08 | 2.11 | 2.25 | 2.13 | 2.10 |
| 3B | 0.65 | 0.67 | 0.71 | 0.67 | 0.63 | 0.70 | 0.67 |
| SS | 1.55 | 1.50 | 1.60 | 1.60 | 1.59 | 1.51 | 1.56 |
| OF | 5.39 | 5.80 | 5.96 | 6.08 | 6.31 | 6.40 | 5.99 |
| P | 0.45 | 0.50 | 0.49 | 0.46 | 0.45 | 0.44 | 0.47 |

### NPBデータの特徴

- **1B**: 内野ゴロの大半が1塁送球で処理されるため、PO/Gが全ポジション最大（8.57）
- **C**: 三振時のPOが大部分。1試合7個前後の三振 → 捕手のPO（7.33）
- **SS**: POは意外と少なく（1.56）、Aが多い（2.80）。ゴロを捌いて1塁に送球するパターンが主
- **P**: 投手は守備機会がある（TC=1.87）。バント処理・ゴロ処理で補殺が多い（A=1.33）
- **外野**: 3ポジション合計でPO=5.99。CFがやや多いがLF/RFとの差は小さい
- **外野A**: 外野手の補殺は非常に少ない（A合計0.13/G = 1人0.04/G程度）
- **年別傾向**: 外野PO増加傾向（2020: 5.39→2025: 6.40）、投手A減少傾向（2020: 1.44→2025: 1.20）

---

## 2. シミュレーション値（N=2000試合）

能力値オール50の均等チーム同士で2000試合シミュレーションした平均値。

### 調整前（Step 6時点）

| Pos | PO/G | A/G | E/G | TC/G |
|---|---|---|---|---|
| P | 0.00 | 0.03 | 0.00 | 0.03 |
| C | 6.19 | 0.05 | 0.00 | 6.24 |
| 1B | 6.56 | 0.77 | 0.04 | 7.37 |
| 2B | 1.61 | 2.28 | 0.06 | 3.95 |
| 3B | 0.42 | 1.37 | 0.03 | 1.82 |
| SS | 3.28 | 3.50 | 0.07 | 6.86 |
| LF | 3.04 | 0.28 | 0.03 | 3.35 |
| CF | 5.05 | 0.44 | 0.04 | 5.53 |
| RF | 1.04 | 0.09 | 0.01 | 1.15 |
| **合計** | **27.19** | **8.81** | **0.28** | **36.30** |

### 調整後（Step 7完了）

| Pos | PO/G | A/G | E/G | TC/G |
|---|---|---|---|---|
| P | 0.02 | 0.10 | 0.00 | 0.13 |
| C | 6.24 | 0.51 | 0.00 | 6.75 |
| 1B | 8.07 | 0.42 | 0.03 | 8.52 |
| 2B | 1.32 | 2.69 | 0.06 | 4.07 |
| 3B | 0.52 | 1.38 | 0.03 | 1.93 |
| SS | 2.40 | 3.49 | 0.07 | 5.96 |
| LF | 3.39 | 0.05 | 0.03 | 3.47 |
| CF | 3.14 | 0.04 | 0.02 | 3.21 |
| RF | 2.01 | 0.03 | 0.02 | 2.06 |
| **合計** | **27.11** | **8.73** | **0.26** | **36.10** |

---

## 3. 乖離分析（調整前 → 調整後）

### 色分けルール: 🔴 大幅乖離 / 🟡 やや乖離 / 🟢 良好

| Pos | 指標 | 調整前 | 調整後 | NPB 6年平均 | 評価 | 備考 |
|---|---|---|---|---|---|---|
| **P** | TC | 0.03 | 0.13 | 1.87 | 🔴→🔴 | バント未実装のため限界あり |
| **C** | PO | 6.19 | 6.24 | 7.33 | 🟢→🟡 | 三振率の差で1程度低い |
| **C** | A | 0.05 | 0.51 | 0.78 | 🔴→🟡 | 捕手関与プレー追加で改善 |
| **1B** | PO | 6.56 | 8.07 | 8.57 | 🔴→🟢 | **大幅改善** |
| **2B** | TC | 3.95 | 4.07 | 5.17 | 🟡→🟡 | やや低め |
| **3B** | TC | 1.82 | 1.93 | 2.38 | 🟢→🟢 | 良好 |
| **SS** | PO | 3.28 | 2.40 | 1.56 | 🔴→🟡 | フォースアウト率削減で改善 |
| **SS** | TC | 6.86 | 5.96 | 4.45 | 🔴→🟡 | 改善したがまだやや高め |
| **LF** | PO | 3.04 | 3.39 | ~1.77 | 🟡→🟡 | 右打者プル傾向の影響 |
| **CF** | PO | 5.05 | 3.14 | ~2.34 | 🔴→🟡 | **大幅改善** |
| **RF** | PO | 1.04 | 2.01 | ~1.88 | 🔴→🟢 | **ほぼ完璧** |
| **OF全体** | A | 0.81 | 0.12 | 0.13 | 🔴→🟢 | **完璧** |

---

## 4. 根本原因と修正方針

### 原因1: 外野ゾーン幅のアンバランス（CF偏重）

**現状のゾーン:**
```
方向  0°──────30°──────60°──────90°
      |  LF 30°  |  CF 30° |  RF 30° |
```

**問題**: CFに30°の幅は広すぎ。実際のCFはセンター付近を中心にLF/RFより若干広い程度。

**修正案:**
```
方向  0°──────28°───────55°─────────90°
      |  LF 28°  | CF 27° |   RF 35°  |
```
CFゾーンを27°に縮小、RFゾーンを35°に拡大。右打者が多い前提でRFをやや広く取る。

### 原因2: フォースアウト率が高すぎる（95% → 40%）

**現状**: `if (bases.first && Math.random() < 0.95)` で1塁走者がいると95%の確率で2塁フォースアウト。
→ SSのPOが3.28と異常に高い。

**実際**: 走者1塁+ゴロの場合、2塁送球は全体の40%程度。残りは1塁送球が標準。

**修正案**: `0.95` → `0.40` に変更

### 原因3: 投手の関与率が低すぎる（12% → 20%）

**現状**: `assignInfielder`で投手への打球は「中央30-60°かつ低速<110km/h」の条件で12%のみ。
→ 投手TC=0.03/Gでほぼゼロ。

**実際**: 投手はバント処理・ゴロ処理で年間20-30機会（TC=2.0/G程度）。

**修正案**:
- ゾーンを25-65°に拡大（中央40°幅）
- 速度条件を<120km/hに緩和
- 確率を12% → 20%に引き上げ

### 原因4: 外野中継補殺率が非現実的（20% → 3%）

**現状**: 外野フライアウト時に20%（ライナー18%、犠飛25%）で中継補殺を記録。
→ 外野手の年間A/G = 0.3前後。

**実際**: 外野手の年間補殺は3-5個（0.03/G）。走者タッチアップ阻止は年数回。

**修正案**: flyout=3%, lineout=3%, sacrificeFly=5% に削減

### 原因5: ライナーの内外野振り分けが外野寄り

**現状**: `exitVelocity > 140 || launchAngle > 14` で外野。
→ 大半のライナーが外野に行き、CFゾーンに集中。

**修正案**: `exitVelocity > 145 || launchAngle > 16` に変更（より高速・高角度のみ外野へ）

### 原因6: 捕手の補殺源が不足

**現状**: 捕手Aは盗塁死のみ（0.05/G）。

**実際**: 捕手の補殺（0.7/G）は主に：盗塁阻止、バント処理送球、三塁走者牽制、併殺連携など。

**修正案**: 三振以外のアウト時に5%の確率で「捕手が関与した中継プレー」として捕手にAを記録。

---

## 5. 調整結果サマリー

| Pos | 調整前TC | 調整後TC | NPB 6年平均TC | 達成度 |
|---|---|---|---|---|
| P | 0.03 | 0.13 | 1.87 | 7% (バント未実装) |
| C | 6.24 | 6.75 | 8.15 | 83% |
| 1B | 7.37 | 8.52 | 9.28 | 92% |
| 2B | 3.95 | 4.07 | 5.17 | 79% |
| 3B | 1.82 | 1.93 | 2.38 | 81% |
| SS | 6.86 | 5.96 | 4.45 | 66% (改善余地あり) |
| LF | 3.35 | 3.47 | ~1.84 | 53% (OFフライ率の問題) |
| CF | 5.53 | 3.21 | ~2.41 | 67% (大幅改善) |
| RF | 1.15 | 2.06 | ~1.95 | 95% |

### 残存課題（将来の改善候補）

1. **P TC = 0.13 (目標2.0)**: バント処理が未実装のため投手の守備機会は低いまま。バント機能を実装すれば自然に改善される。
2. **SS TC = 5.96 (目標4.3)**: フォースアウト率を95%→40%に下げたが、SSのゾーン幅が広いため機会が多い。SSゾーンの縮小（40→38°）で改善可能。
3. **LF PO = 3.39 (目標2.0)**: 右打者のプル傾向（方向平均38°）によりLFに打球が集中。打球方向の平均を調整するか、フライアウト率を下げることで改善可能。
4. **外野PO合計 = 8.54 (目標6.5)**: シミュレーションのフライ/ライナーのアウト率がやや高い。打球角度分布の調整で長期的に改善可能。

---

## 6. 変更箇所まとめ（simulation.ts）

| # | 関数/場所 | 変更内容 |
|---|---|---|
| F1 | `assignOutfielder` | LF: <28°, CF: <55°, RF: ≥55°（CF幅27°に縮小、RF拡大） |
| F2 | `assignInfielder` | P条件拡大（25-65°, <120km/h, 20%）, 2Bゾーン拡大（<58°） |
| F3 | `simulateHalfInning` groundout | フォースアウト率 0.95 → 0.40 |
| F4 | `simulateHalfInning` flyout | 中継補殺率 0.20 → 0.03 |
| F5 | `simulateHalfInning` lineout | 中継補殺率 0.18 → 0.03 |
| F6 | `simulateHalfInning` sacrificeFly | 中継補殺率 0.25 → 0.05 |
| F7 | `determineFielderFromBall` liner | 外野条件: >140\|\|>14 → >145\|\|>16 |
| F8 | `simulateHalfInning` groundout | 捕手関与プレー追加（5%でC:A記録） |
