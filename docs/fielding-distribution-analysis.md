# NPB守備機会分布 vs シミュレーション比較分析

## 概要

シミュレーションの守備機会分布がNPB実データとどれだけ乖離しているかを分析し、調整方針をまとめた資料。

---

## 1. NPB実データ（2024年シーズン）

出典: npb.jp 2024年度セ・パ両リーグ個人守備成績 + チーム守備成績

### チーム平均（1試合あたり）

| 指標 | NPB 2024 |
|---|---|
| 刺殺 (PO) / 試合 | 26.88 |
| 補殺 (A) / 試合 | 10.55 |
| 失策 (E) / 試合 | 0.50 |
| 守備機会 (TC) / 試合 | 37.93 |

### ポジション別（1人1試合あたり、主要レギュラーから算出）

| Pos | PO/G | A/G | E/G | TC/G | 算出方法 |
|---|---|---|---|---|---|
| P | 0.4 | 1.5 | 0.06 | 2.0 | 先発投手の6回分を9回換算（×1.5） |
| C | 6.3 | 0.7 | 0.03 | 7.0 | セパ主力捕手12名の平均 |
| 1B | 8.2 | 0.6 | 0.06 | 8.9 | セパ主力一塁手5名の平均 |
| 2B | 2.1 | 2.9 | 0.06 | 5.1 | セパ主力二塁手9名の平均 |
| 3B | 0.6 | 1.5 | 0.08 | 2.2 | セパ主力三塁手10名の平均 |
| SS | 1.5 | 2.7 | 0.07 | 4.3 | セパ主力遊撃手11名の平均 |
| LF | 2.0 | 0.04 | 0.02 | 2.1 | セパ主力外野手の平均 |
| CF | 2.5 | 0.04 | 0.02 | 2.5 | 近本・辰己・岡林・桑原等から推定 |
| RF | 2.0 | 0.04 | 0.02 | 2.1 | セパ主力外野手の平均 |
| **合計** | **23.6** | **10.0** | **0.4** | **34.2** | |

> 注: チーム合計は27アウト×PO比率で理論値とやや差がある。PO/Gの合計が27にならないのは、
> 三振でのPO（捕手に記録）がレギュラー数の加重平均では拾いきれないため。

### NPBデータの特徴

- **1B**: 内野ゴロの大半が1塁送球で処理されるため、PO/Gが全ポジション最大（8.2）
- **C**: 三振時のPOが大きい。1試合6-7個の三振 → 捕手のPO（6.3）
- **SS**: POは意外と少なく（1.5）、Aが多い（2.7）。ゴロを捌いて1塁に送球するパターンが主
- **P**: 投手は意外と守備機会がある（TC=2.0）。バント処理・ゴロ処理で補殺が多い
- **外野**: 3ポジション合計でPO=6.5程度。CFがやや多いがLF/RFとの差は小さい
- **外野A**: 外野手の補殺は非常に少ない（年間3-5個 = 0.03-0.04/G）

---

## 2. シミュレーション値（N=2000試合）

能力値オール50の均等チーム同士で2000試合シミュレーションした平均値。

### 調整前（Step 6時点）

| Pos | PO/G | A/G | E/G | TC/G |
|---|---|---|---|---|
| P | 0.00 | 0.03 | 0.00 | 0.03 |
| C | 6.19 | 0.05 | 0.00 | 6.24 |
| 1B | 6.56 | 0.77 | 0.04 | 7.37 |
| 2B | 1.61 | 2.28 | 0.06 | 3.95 |
| 3B | 0.42 | 1.37 | 0.03 | 1.82 |
| SS | 3.28 | 3.50 | 0.07 | 6.86 |
| LF | 3.04 | 0.28 | 0.03 | 3.35 |
| CF | 5.05 | 0.44 | 0.04 | 5.53 |
| RF | 1.04 | 0.09 | 0.01 | 1.15 |
| **合計** | **27.19** | **8.81** | **0.28** | **36.30** |

### 調整後（Step 7完了）

| Pos | PO/G | A/G | E/G | TC/G |
|---|---|---|---|---|
| P | 0.02 | 0.10 | 0.00 | 0.13 |
| C | 6.24 | 0.51 | 0.00 | 6.75 |
| 1B | 8.07 | 0.42 | 0.03 | 8.52 |
| 2B | 1.32 | 2.69 | 0.06 | 4.07 |
| 3B | 0.52 | 1.38 | 0.03 | 1.93 |
| SS | 2.40 | 3.49 | 0.07 | 5.96 |
| LF | 3.39 | 0.05 | 0.03 | 3.47 |
| CF | 3.14 | 0.04 | 0.02 | 3.21 |
| RF | 2.01 | 0.03 | 0.02 | 2.06 |
| **合計** | **27.11** | **8.73** | **0.26** | **36.10** |

---

## 3. 乖離分析（調整前 → 調整後）

### 色分けルール: 🔴 大幅乖離 / 🟡 やや乖離 / 🟢 良好

| Pos | 指標 | 調整前 | 調整後 | NPB | 評価 | 備考 |
|---|---|---|---|---|---|---|
| **P** | TC | 0.03 | 0.13 | 2.0 | 🔴→🔴 | バント未実装のため限界あり |
| **C** | PO | 6.19 | 6.24 | 6.3 | 🟢→🟢 | 三振PO記録が正常 |
| **C** | A | 0.05 | 0.51 | 0.7 | 🔴→🟡 | 捕手関与プレー追加で改善 |
| **1B** | PO | 6.56 | 8.07 | 8.2 | 🔴→🟢 | **大幅改善** |
| **2B** | TC | 3.95 | 4.07 | 5.1 | 🟡→🟡 | やや低め |
| **3B** | TC | 1.82 | 1.93 | 2.2 | 🟢→🟢 | 良好 |
| **SS** | PO | 3.28 | 2.40 | 1.5 | 🔴→🟡 | フォースアウト率削減で改善 |
| **SS** | TC | 6.86 | 5.96 | 4.3 | 🔴→🟡 | 改善したがまだやや高め |
| **LF** | PO | 3.04 | 3.39 | 2.0 | 🟡→🟡 | 右打者プル傾向の影響 |
| **CF** | PO | 5.05 | 3.14 | 2.5 | 🔴→🟡 | **大幅改善** |
| **RF** | PO | 1.04 | 2.01 | 2.0 | 🔴→🟢 | **ほぼ完璧** |
| **OF全体** | A | 0.81 | 0.12 | 0.12 | 🔴→🟢 | **完璧** |

---

## 4. 根本原因と修正方針

### 原因1: 外野ゾーン幅のアンバランス（CF偏重）

**現状のゾーン:**
```
方向  0°──────30°──────60°──────90°
      |  LF 30°  |  CF 30° |  RF 30° |
```

**問題**: CFに30°の幅は広すぎ。実際のCFはセンター付近を中心にLF/RFより若干広い程度。

**修正案:**
```
方向  0°──────28°───────55°─────────90°
      |  LF 28°  | CF 27° |   RF 35°  |
```
CFゾーンを27°に縮小、RFゾーンを35°に拡大。右打者が多い前提でRFをやや広く取る。

### 原因2: フォースアウト率が高すぎる（95% → 40%）

**現状**: `if (bases.first && Math.random() < 0.95)` で1塁走者がいると95%の確率で2塁フォースアウト。
→ SSのPOが3.28と異常に高い。

**実際**: 走者1塁+ゴロの場合、2塁送球は全体の40%程度。残りは1塁送球が標準。

**修正案**: `0.95` → `0.40` に変更

### 原因3: 投手の関与率が低すぎる（12% → 20%）

**現状**: `assignInfielder`で投手への打球は「中央30-60°かつ低速<110km/h」の条件で12%のみ。
→ 投手TC=0.03/Gでほぼゼロ。

**実際**: 投手はバント処理・ゴロ処理で年間20-30機会（TC=2.0/G程度）。

**修正案**:
- ゾーンを25-65°に拡大（中央40°幅）
- 速度条件を<120km/hに緩和
- 確率を12% → 20%に引き上げ

### 原因4: 外野中継補殺率が非現実的（20% → 3%）

**現状**: 外野フライアウト時に20%（ライナー18%、犠飛25%）で中継補殺を記録。
→ 外野手の年間A/G = 0.3前後。

**実際**: 外野手の年間補殺は3-5個（0.03/G）。走者タッチアップ阻止は年数回。

**修正案**: flyout=3%, lineout=3%, sacrificeFly=5% に削減

### 原因5: ライナーの内外野振り分けが外野寄り

**現状**: `exitVelocity > 140 || launchAngle > 14` で外野。
→ 大半のライナーが外野に行き、CFゾーンに集中。

**修正案**: `exitVelocity > 145 || launchAngle > 16` に変更（より高速・高角度のみ外野へ）

### 原因6: 捕手の補殺源が不足

**現状**: 捕手Aは盗塁死のみ（0.05/G）。

**実際**: 捕手の補殺（0.7/G）は主に：盗塁阻止、バント処理送球、三塁走者牽制、併殺連携など。

**修正案**: 三振以外のアウト時に5%の確率で「捕手が関与した中継プレー」として捕手にAを記録。

---

## 5. 調整結果サマリー

| Pos | 調整前TC | 調整後TC | NPB TC | 達成度 |
|---|---|---|---|---|
| P | 0.03 | 0.13 | 2.0 | 6% (バント未実装) |
| C | 6.24 | 6.75 | 7.0 | 96% |
| 1B | 7.37 | 8.52 | 8.9 | 96% |
| 2B | 3.95 | 4.07 | 5.1 | 80% |
| 3B | 1.82 | 1.93 | 2.2 | 88% |
| SS | 6.86 | 5.96 | 4.3 | 71% (改善余地あり) |
| LF | 3.35 | 3.47 | 2.1 | 60% (OFフライ率の問題) |
| CF | 5.53 | 3.21 | 2.5 | 77% (大幅改善) |
| RF | 1.15 | 2.06 | 2.1 | 98% |

### 残存課題（将来の改善候補）

1. **P TC = 0.13 (目標2.0)**: バント処理が未実装のため投手の守備機会は低いまま。バント機能を実装すれば自然に改善される。
2. **SS TC = 5.96 (目標4.3)**: フォースアウト率を95%→40%に下げたが、SSのゾーン幅が広いため機会が多い。SSゾーンの縮小（40→38°）で改善可能。
3. **LF PO = 3.39 (目標2.0)**: 右打者のプル傾向（方向平均38°）によりLFに打球が集中。打球方向の平均を調整するか、フライアウト率を下げることで改善可能。
4. **外野PO合計 = 8.54 (目標6.5)**: シミュレーションのフライ/ライナーのアウト率がやや高い。打球角度分布の調整で長期的に改善可能。

---

## 6. 変更箇所まとめ（simulation.ts）

| # | 関数/場所 | 変更内容 |
|---|---|---|
| F1 | `assignOutfielder` | LF: <28°, CF: <55°, RF: ≥55°（CF幅27°に縮小、RF拡大） |
| F2 | `assignInfielder` | P条件拡大（25-65°, <120km/h, 20%）, 2Bゾーン拡大（<58°） |
| F3 | `simulateHalfInning` groundout | フォースアウト率 0.95 → 0.40 |
| F4 | `simulateHalfInning` flyout | 中継補殺率 0.20 → 0.03 |
| F5 | `simulateHalfInning` lineout | 中継補殺率 0.18 → 0.03 |
| F6 | `simulateHalfInning` sacrificeFly | 中継補殺率 0.25 → 0.05 |
| F7 | `determineFielderFromBall` liner | 外野条件: >140\|\|>14 → >145\|\|>16 |
| F8 | `simulateHalfInning` groundout | 捕手関与プレー追加（5%でC:A記録） |
